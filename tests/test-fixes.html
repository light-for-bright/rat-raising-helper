<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест исправлений</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container mt-4">
        <h1>Тест исправлений</h1>
        
        <!-- Тест уведомлений -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="h6 mb-0">Тест уведомлений</h5>
            </div>
            <div class="card-body">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-success" onclick="testSuccessNotification()">Успех</button>
                    <button type="button" class="btn btn-info" onclick="testInfoNotification()">Информация</button>
                    <button type="button" class="btn btn-warning" onclick="testWarningNotification()">Предупреждение</button>
                    <button type="button" class="btn btn-danger" onclick="testErrorNotification()">Ошибка</button>
                </div>
            </div>
        </div>
        
        <!-- Тест валидации количества детей -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="h6 mb-0">Тест валидации количества детей</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Количество детей (максимум 3)</label>
                    <input type="number" class="form-control" id="children-count" placeholder="0" min="0" max="3">
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="testChildrenValidation(0)">0 детей</button>
                    <button type="button" class="btn btn-outline-primary" onclick="testChildrenValidation(3)">3 детей</button>
                    <button type="button" class="btn btn-outline-danger" onclick="testChildrenValidation(4)">4 детей (ошибка)</button>
                    <button type="button" class="btn btn-outline-danger" onclick="testChildrenValidation(-1)">-1 детей (ошибка)</button>
                </div>
            </div>
        </div>
        
        <!-- Тест бланка учета денежных средств -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="h6 mb-0">Тест бланка учета денежных средств</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Сбережения</label>
                            <input type="number" class="form-control" id="cashflow-savings" placeholder="0" step="0.01">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Месячный денежный поток</label>
                            <input type="number" class="form-control" id="cashflow-monthly-cashflow" placeholder="0" step="0.01">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Стартовый капитал</label>
                            <div id="starting-capital" class="form-control-plaintext fw-bold text-primary">0 ₽</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Текущий баланс</label>
                            <div id="current-balance" class="form-control-plaintext fw-bold text-success">0 ₽</div>
                        </div>
                    </div>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="testCashFlow()">Тест расчета</button>
                    <button type="button" class="btn btn-outline-success" onclick="initCashFlowTab()">Инициализация</button>
                </div>
            </div>
        </div>
        
        <!-- Консоль отладки -->
        <div class="mt-4">
            <h3>Консоль отладки</h3>
            <div id="console" class="bg-dark text-light p-3" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
            </div>
        </div>
    </div>

    <!-- Подключение JavaScript файлов -->
    <script src="js/game-data.js?v=8"></script>
    <script src="js/calculations.js?v=2"></script>
    <script src="js/app.js?v=21"></script>
    
    <script>
        // Переопределяем функцию log для отображения в консоли
        function log(message, data = null) {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.innerHTML += logMessage + '<br>';
            if (data) {
                console.innerHTML += JSON.stringify(data, null, 2) + '<br>';
            }
            console.scrollTop = console.scrollHeight;
        }
        
        // Тест уведомлений
        function testSuccessNotification() {
            if (typeof showSuccessNotification === 'function') {
                showSuccessNotification('Уведомления работают!');
                addToConsole('✅ Уведомления работают');
            } else {
                addToConsole('❌ Функция showSuccessNotification не найдена');
            }
        }
        
        function testInfoNotification() {
            if (typeof showInfoNotification === 'function') {
                showInfoNotification('Информационное сообщение');
                addToConsole('ℹ️ Информационное уведомление показано');
            } else {
                addToConsole('❌ Функция showInfoNotification не найдена');
            }
        }
        
        function testWarningNotification() {
            if (typeof showWarningNotification === 'function') {
                showWarningNotification('Предупреждение');
                addToConsole('⚠️ Предупреждение показано');
            } else {
                addToConsole('❌ Функция showWarningNotification не найдена');
            }
        }
        
        function testErrorNotification() {
            if (typeof showUserNotification === 'function') {
                showUserNotification('Ошибка', 'danger');
                addToConsole('❌ Уведомление об ошибке показано');
            } else {
                addToConsole('❌ Функция showUserNotification не найдена');
            }
        }
        
        // Тест валидации количества детей
        function testChildrenValidation(value) {
            const input = document.getElementById('children-count');
            input.value = value;
            input.dispatchEvent(new Event('input'));
            
            const isValid = !input.classList.contains('is-invalid');
            addToConsole(`Количество детей: ${value} - ${isValid ? 'ВАЛИДНО' : 'НЕ ВАЛИДНО'}`);
        }
        
        // Тест бланка учета денежных средств
        function testCashFlow() {
            const savingsField = document.getElementById('cashflow-savings');
            const monthlyCashFlowField = document.getElementById('cashflow-monthly-cashflow');
            
            savingsField.value = 100000;
            monthlyCashFlowField.value = 50000;
            
            savingsField.dispatchEvent(new Event('input'));
            monthlyCashFlowField.dispatchEvent(new Event('input'));
            
            addToConsole('Тест бланка учета: сбережения=100,000, поток=50,000');
            addToConsole('Стартовый капитал должен быть: 150,000');
        }
        
        function addToConsole(message) {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `[${timestamp}] ${message}<br>`;
            console.scrollTop = console.scrollHeight;
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            addToConsole('Страница загружена');
            addToConsole('Тестирование исправлений...');
            
            // Проверяем доступность функций
            const functions = ['showSuccessNotification', 'showInfoNotification', 'showWarningNotification', 'showUserNotification', 'initCashFlowTab'];
            functions.forEach(func => {
                if (typeof window[func] === 'function') {
                    addToConsole(`✅ Функция ${func} доступна`);
                } else {
                    addToConsole(`❌ Функция ${func} недоступна`);
                }
            });
        });
    </script>
</body>
</html>
